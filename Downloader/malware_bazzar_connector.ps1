function Download-Hashes {
    param(
        $downloadFreshHashes = "Yes",
        $allHashesUrl = "https://bazaar.abuse.ch/export/csv/full/",
        $recentHashesUrl = "https://bazaar.abuse.ch/export/csv/recent/"
    )
    
    $scriptPath = $PSScriptRoot
    $zipPath = Join-Path $scriptPath "hashes.zip"
    $csvPath = Join-Path $scriptPath "full.csv"
    $recentCsvPath = Join-Path $scriptPath "recent.csv"
    
    # Pobierz wszystkie hashe jeśli nie istnieją
    if (!(Test-Path -Path $zipPath)) {
        Write-Host "[Info] Downloading all hashes..." -ForegroundColor Yellow 
        $ProgressPreference = 'SilentlyContinue'
        Invoke-WebRequest -Uri $allHashesUrl -OutFile $zipPath -UseBasicParsing
        $ProgressPreference = 'Continue'
    
        Expand-Archive -Path $zipPath -DestinationPath $scriptPath -Force
        Write-Host "[Info] File with all hashes downloaded" -ForegroundColor Green 
    } else { 
        Write-Host "[Info] File with all hashes already exists" -ForegroundColor Green
    }
    
    # Pobierz świeże hashe jeśli wybrano "Yes"
    if ($downloadFreshHashes -eq "Yes") {
        # Usuń stary plik jeśli istnieje
        if (Test-Path -Path $recentCsvPath) {
            Write-Host "[Info] Deleting old recent hashes" -ForegroundColor Yellow
            Remove-Item -Path $recentCsvPath -Force
        }        
        
        Write-Host "[Info] Downloading fresh hashes..." -ForegroundColor Yellow
        $ProgressPreference = 'SilentlyContinue'
        Invoke-WebRequest -Uri $recentHashesUrl -OutFile $recentCsvPath -UseBasicParsing
        $ProgressPreference = 'Continue'
        Write-Host "[Info] Fresh hashes downloaded" -ForegroundColor Green
    } else {
        Write-Host "[Info] Skipping fresh hashes download" -ForegroundColor Yellow
    }
}

Download-Hashes -downloadFreshHashes "Yes"